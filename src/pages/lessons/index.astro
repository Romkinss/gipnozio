---
import { getCollection } from 'astro:content';
import '../../styles/globals.css';

// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —É—Ä–æ–∫–∏
const allLessons = await getCollection('lessons');

// –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø–æ—Ä—è–¥–∫—É
const sortedLessons = allLessons.sort((a, b) => (a.data.lesson_order || 0) - (b.data.lesson_order || 0));

// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –º–æ–¥—É–ª—è–º
const lessonsByModule = sortedLessons.reduce((acc, lesson) => {
  const module = lesson.data.module_number || '–ë–µ–∑ –º–æ–¥—É–ª—è';
  if (!acc[module]) {
    acc[module] = [];
  }
  acc[module].push(lesson);
  return acc;
}, {} as Record<string | number, any[]>);

const modules = Object.keys(lessonsByModule).sort();

const levelColors: Record<string, string> = {
  'beginner': 'bg-green-100 text-green-800',
  'intermediate': 'bg-yellow-100 text-yellow-800',
  'advanced': 'bg-red-100 text-red-800',
};

const levelLabels: Record<string, string> = {
  'beginner': '–ù–∞—á–∏–Ω–∞—é—â–∏–π',
  'intermediate': '–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å',
  'advanced': '–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π',
};
---

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–£—Ä–æ–∫–∏ –≥–∏–ø–Ω–æ—Ç–µ—Ä–∞–ø–∏–∏ - –ì–ò–ü–ù–û–ó–ò–û</title>
    <meta name="description" content="–ü–æ–ª–Ω—ã–π –∫—É—Ä—Å –æ–±—É—á–µ–Ω–∏—è –≥–∏–ø–Ω–æ—Ç–µ—Ä–∞–ø–∏–∏. –ò–∑—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤—ã, —Ç–µ—Ö–Ω–∏–∫–∏ –∏ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞–≤—ã–∫–∏ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏–µ–º.">
    <meta name="keywords" content="–≥–∏–ø–Ω–æ—Ç–µ—Ä–∞–ø–∏—è, –æ–±—É—á–µ–Ω–∏–µ, —É—Ä–æ–∫–∏, –∫—É—Ä—Å, –≥–∏–ø–Ω–æ–∑">
    <meta property="og:title" content="–£—Ä–æ–∫–∏ –ì–ò–ü–ù–û–ó–ò–û">
    <meta property="og:description" content="–ü–æ–ª–Ω—ã–π –∫—É—Ä—Å –æ–±—É—á–µ–Ω–∏—è –≥–∏–ø–Ω–æ—Ç–µ—Ä–∞–ø–∏–∏">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gipnozio.ru/lessons">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="canonical" href="https://gipnozio.ru/lessons">
</head>
<body class="bg-light text-dark antialiased">
    <!-- Hero Section -->
    <section class="bg-dark text-white py-16 md:py-24">
        <div class="container mx-auto px-4">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">–£—Ä–æ–∫–∏ –≥–∏–ø–Ω–æ—Ç–µ—Ä–∞–ø–∏–∏</h1>
            <p class="text-xl text-primary">–ü–æ–ª–Ω—ã–π –∫—É—Ä—Å –æ–±—É—á–µ–Ω–∏—è –æ—Ç –æ—Å–Ω–æ–≤ –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ç–µ—Ö–Ω–∏–∫</p>
        </div>
    </section>

    <!-- Lessons Section -->
    <section class="py-16 md:py-24">
        <div class="container mx-auto px-4">
            {modules.map((module) => (
                <div class="mb-16">
                    <h2 class="text-3xl font-bold text-dark mb-8">–ú–æ–¥—É–ª—å {module}</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {lessonsByModule[module].map((lesson) => (
                            <a href={`/lessons/${lesson.slug}`} class="group">
                                <div class="border border-gray-200 rounded-lg overflow-hidden hover:shadow-lg transition h-full flex flex-col">
                                    <div class="bg-gradient-to-br from-primary/20 to-primary/5 p-6 flex-1">
                                        <div class="flex items-start justify-between mb-4">
                                            <div class="flex-1">
                                                <h3 class="text-xl font-bold text-dark group-hover:text-primary transition mb-2">
                                                    {lesson.data.title}
                                                </h3>
                                                <p class="text-gray-600 text-sm mb-4">{lesson.data.description}</p>
                                            </div>
                                        </div>
                                        
                                        <div class="flex flex-wrap gap-2 mb-4">
                                            {lesson.data.level && (
                                                <span class={`inline-block px-2 py-1 rounded text-xs font-medium ${levelColors[lesson.data.level] || 'bg-gray-100 text-gray-800'}`}>
                                                    {levelLabels[lesson.data.level] || '–í—Å–µ —É—Ä–æ–≤–Ω–∏'}
                                                </span>
                                            )}
                                        </div>

                                        <div class="flex items-center gap-4 text-sm text-gray-600">
                                            <span class="flex items-center gap-1">
                                                ‚è±Ô∏è {lesson.data.duration} –º–∏–Ω
                                            </span>
                                            <span class="flex items-center gap-1">
                                                üìö –£—Ä–æ–∫ {lesson.data.lesson_order}
                                            </span>
                                        </div>
                                    </div>
                                    
                                    <div class="px-6 py-4 bg-white border-t border-gray-200 group-hover:bg-primary/5 transition">
                                        <span class="text-primary font-semibold group-hover:text-dark transition">
                                            –ù–∞—á–∞—Ç—å —É—Ä–æ–∫ ‚Üí
                                        </span>
                                    </div>
                                </div>
                            </a>
                        ))}
                    </div>
                </div>
            ))}

            {sortedLessons.length === 0 && (
                <div class="text-center py-12">
                    <p class="text-gray-600 text-lg">–£—Ä–æ–∫–∏ –µ—â–µ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏!</p>
                </div>
            )}
        </div>
    </section>

    <!-- CTA Section -->
    <section class="bg-dark text-white py-16 md:py-24">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-4">–ì–æ—Ç–æ–≤—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ?</h2>
            <p class="text-xl text-primary mb-8">–ù–∞—á–Ω–∏—Ç–µ —Å –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–∫–∞ –∏ —Ä–∞–∑–≤–∏–≤–∞–π—Ç–µ —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –≥–∏–ø–Ω–æ—Ç–µ—Ä–∞–ø–∏–∏</p>
            {sortedLessons.length > 0 && (
                <a href={`/lessons/${sortedLessons[0].slug}`} class="inline-block px-8 py-4 bg-primary text-dark font-semibold rounded-lg hover:bg-white transition">
                    –ù–∞—á–∞—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫
                </a>
            )}
        </div>
    </section>
</body>
</html>
